calculate and predict clv
# --- compact_practical5.R ---
# Short, self-contained R script for Practical 5 (replace "yourfile.csv")

# Load packages (install if needed)
if(!require(tidyverse)) install.packages("tidyverse", repos="https://cloud.r-project.org"); library(tidyverse)

# 1. Read data
df <- read_csv("yourfile.csv", show_col_types = FALSE)

# 2. Quick preprocessing
df <- df %>%
  mutate(
    default = as.factor(default),
    housing = as.factor(housing),
    loan    = as.factor(loan)
  ) %>%
  select(-c(unnecessary_variable1, unnecessary_variable2), everything()) # change names if present

# 3. Missing check
if(any(is.na(df))) print(summary(df %>% summarise_all(~sum(is.na(.)))))

# 4. Outlier detection on 'duration' using z-score and remove extreme outliers (|z| > 3)
zs <- scale(df$duration)
outliers_idx <- which(abs(zs) > 3)
if(length(outliers_idx)>0) df <- df[-outliers_idx, ]

# 5. Train/test split (80/20)
set.seed(123)
train_idx <- sample(seq_len(nrow(df)), size = floor(0.8*nrow(df)))
train <- df[train_idx, ]
test  <- df[-train_idx, ]

# 6. Linear regression for CLV (duration) prediction
lm_model <- lm(duration ~ age + campaign + pdays + previous, data = train)
pred_lm  <- predict(lm_model, newdata = test)
mse <- mean((test$duration - pred_lm)^2)
cat("Linear model MSE:", round(mse,2), "\n")

# 7. Plot actual vs predicted (linear)
library(ggplot2)
ggplot(test, aes(x = duration, y = pred_lm)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(title = "Actual vs Predicted (duration)", x = "Actual duration", y = "Predicted duration")

# 8. Logistic regression for default prediction
log_model <- glm(default ~ age + campaign + pdays + previous, data = train, family = binomial)
prob     <- predict(log_model, newdata = test, type = "response")
pred_log <- factor(ifelse(prob > 0.5, "yes", "no"), levels = levels(df$default))
accuracy <- mean(pred_log == test$default)
cat("Logistic model accuracy:", round(accuracy,3), "\n")

# 9. Plot logistic probabilities vs actual default
ggplot(test, aes(x = as.numeric(default=="yes"), y = prob)) +
  geom_jitter(width = 0.1, height = 0) +
  geom_hline(yintercept = 0.5, linetype = "dashed") +
  labs(title = "Logistic: actual vs predicted probability", x = "Actual default (0=no,1=yes)", y = "Predicted prob(default)")

# End of script


install.packages(c("dplyr"
"tidyr", "caret"))
library(dplyr)
library(tidyr) library(caret) library(ggplot2) # Read CSV file df <-
read.csv("C:\\Users\\Raj\\Downloads\\archive (3)\\banking.csv")
summary(df)
str(df)

> df <- read.csv("C:\\Users\\Raj\\Downloads\\archive (3)\\banking.csv")
> summary(df)

Step 2 : Data preprocessing any_missing
<- any(is.na(df)) print(any_missing)

# Convert certain columns to factors
df$default <- as.factor(df$default) df$housing
<- as.factor(df$housing) df$loan
<- as.factor(df$loan)

# Remove unnecessary columns (replace with actual column names) df <-
df[,!(names(df) %in%c("unnecessary_variable1", "unnecessary_variable2"))]

Step 3 : Outlier detection # Boxplot to visualize balance
boxplot(df$duration, main = "Duration Boxplot", ylab = "Duration")

# Outlier detection using z-scores z_scores
<- scale(df$duration) threshold = 3 outliers
<- abs(z_scores) > threshold # Remove rows
with outliers & check result df = df[!outliers,
] summary(df)

> z_scores <- scale(df$duration)
> threshold = 3
> outliers <- abs(z_scores) > threshold
> df <- df[!outliers, ]
> summary(df)

Step 4 : Split dataset into Training Data & Testing Data
set.seed(123) split_index <- createDataPartition(df$duration, p= 0.8, list
= FALSE) train_data <- df[split_index,] test_data <- df[-split_index,]

Step 5 : Linear Regression Model for CLV Prediction
model <- lm(duration ~ age + campaign + pdays + previous, data = train_data)
predictions <- predict(model, newdata = test_data)
mse <- mean((test_data$duration - predictions)^2)
print(paste("Mean Squared Error:", mse))

#visualise predicted value vs actual value ggplot()+
geom_point(aes(x=test_data$duration, y=predictions), color = "blue")+
geom_abline(intercept = 0, slope=1, color = "red", linetype = "dashed")+
labs(title = "actual vs predicted clv", x = "Actual clv", y = "Predicted clv")

Step 6 : Logistic Regression Model for Default Prediction logistic_model <- glm(default ~
age + campaign + pdays + previous, data = train_data, family =
"binomial") logistic_probabilities <- predict(logistic_model, newdata = test_data, type =
"response") logistic_predictions <- ifelse(logistic_probabilities > 0.5,1,0) logistic_accuracy
<- sum(logistic_predictions == test_data$default) / nrow(test_data) print(paste("Logistic
Regression Accuracy: ", logistic_accuracy))

Step 7 : Logistic Visualization ggplot()+
geom_point(aes(x=test_data$default, y=logistic_probabilities), color="blue")+
geom_abline(intercept = 0, slope=1, color="red", linetype="dashed")+
labs(title="actual vs predicted clv", x="actual clv", y="predicted clv")
